# Agent Guidelines for Go MCP Integration Project

This document provides essential guidelines and configurations for AI agents working on this Go-based MCP (Model Context Protocol) integration project.

## Project Overview

This is a Go project implementing MCP integration with AI agents, featuring:

- Multi-provider AI agent system
- MCP server integration and tooling
- Session management and chat functionality
- Comprehensive testing and CI/CD pipeline

## Project-Specific Rules

### Code Standards

- **Go Coding Rules**: See `rules/go-coding.md` for comprehensive Go coding standards
- **File Size Limits**: Maximum 500 lines per file (enforced by CI)
- **Testing**: Maintain test coverage and ensure all tests compile after changes
- **Architecture**: Follow Single Responsibility and Dependency Inversion principles

### Development Workflow

- **Question-First Approach**: When users ask questions, propose multiple solution options before implementing
- **Critical Analysis**: Prioritize finding the best solution over user satisfaction
- **Task Management**: Mark incomplete work with `TODO:` comments for easy tracking
- **Code Hygiene**: Remove unused code instead of marking as deprecated (early development phase)
- **Test Compatibility**: Ensure existing tests compile; adapt mocking as needed

## Agent Memory System

### Project Configuration

- **Project ID**: `265ab9ec-11f5-4a09-a50e-9df162f778df` (stored in `.project`)
- **Memory Model**: nomic-embed-text (768 dimensions)
- **Storage**: Vector-based memory with relationship mapping

### Memory Operations

```bash
# Memory fields (all required)
title: string       # Descriptive title
topics: array       # Categorization tags
content: string     # Main content body
metadata object     # Store metadata with every memory
```

### Search Configuration

- **Default Threshold**: 0.5
- **Broad Search**: 0.4-0.6 (discovery, exploration)
- **Precise Search**: 0.7-0.8 (specific information)
- **Strict Search**: 0.8+ (exact matches)

## Brain Management Commands

The following commands are essential to the progress. Give the user choice to apply this commands after a task is done.

### `load brain`

Load project context and development rules to initialize session knowledge.

- Presents all brain entries with titles
- Establishes project context and coding standards

### `compact brain`

Optimize memory storage while preserving essential knowledge.

- Retain project overview and development rules
- Keep current status, remove outdated progress entries

  - **But** before you remove any memory: Analyze it and extract key learnings that you store in the brain.

- Provide comprehensive cleanup summary with rationale

### `update brain`

Continuous learning and knowledge refinement.

- **Pattern Recognition**: Store universal development principles
- **Knowledge Structure**: Split large learnings into organized memories
- **Relationship Mapping**: Maintain connections between related concepts
- **Metadata Management**: Include URLs, sources, and references
  - Use enumerated keys: `github-url-1`, `source-2`, etc. to avoid overriding existing keys with new values
- **Completion**: Follow with brain compaction

## Project Structure

### Key Directories

- `cmd/`: Application entry points
- `internal/`: Private application code
  - `agents/`: AI agent implementations
  - `config/`: Configuration management
  - `providers/`: Provider integrations
  - `session/`: Session and chat management
- `prd/`: Product requirements and documentation
- `rules/`: Development standards and guidelines
- `scripts/`: Utility and build scripts

### Important Files

- `Makefile`: Build and development commands
- `.golangci.yml`: Linting configuration
- `go.mod`/`go.sum`: Go module dependencies
- `test-mcp-servers.json`: MCP server test configurations

## Development Commands

```bash
# File size compliance check
make check-file-length

# MCP integration testing
./scripts/test-mcp-integration.sh

# Run tests with coverage
go test -coverprofile=coverage.out ./...
```

# Best Practices

## Patterns

- Use the options Pattern `options.WithHost(host string)` whereever appropriate.

## Dependency injection

- Use DI over direct accessing the implementation.
- Use interfaces over implementation (di)->(interfaces)->(implementation)
- Make implementations private.

## Logging

- use the `logger.WithPackage("package)` pattern in a package `logger.go` file

## Building

- keep the codebase free from build artifacts
- build whenever possible in `/tmp/forge-build`

### using sed

- before using the `sed` command **backup the file** to keep a functional version if code gets corrupted.

## Code Quality

- Enforce SOLID principles throughout codebase
- Maintain comprehensive error handling with custom error types
- Use descriptive naming conventions (camelCase/PascalCase)
- Document all public APIs and complex logic

## Testing Strategy

- Write tests for new functionality
- Maintain existing test compatibility
- Use appropriate mocking for external dependencies
- Aim for meaningful test coverage

## Documentation

- Keep README.md current with project changes
- Document architectural decisions in `prd/` directory
- Maintain inline code documentation for complex logic
- Update this `.agent.md` file as project evolves

# Project Initialization

If no `.project` file exists, you **MUST** create a new project:

1. Call `create_project` to generate a new project
2. Save the returned project_id to `.project` file
3. Use this project_id for all subsequent memory operations

```bash
# Example workflow:
# 1. Check if .project exists
# 2. If not, call create_project
# 3. Save project_id to .project
# 4. Use project_id for all memory operations
```

# Enforce this!

**After every minor milestone** the agent must enforce:

- [Dependency Injection](./DI_ENFORCEMENT_PLAN.md)
- [Development workflow](./DEV_WORKFLOW.md)
- File size constrains

---

_This document should be treated as a living guide that evolves with the project. Keep it updated to reflect current development practices and project structure._
